{"version":3,"sources":["Xiaozhuankuai.js"],"names":["config","require","m_speed","m_spaceX","cc","winSize","width","m_spaceY","m_startHeight","Class","extends","Component","properties","sfBrickBreak","SpriteFrame","brickLine1","Prefab","brickLine2","quantao","spriteBg","Node","dandao1","dandao2","dandao3","dandao4","scrollNode","timer","Button","playNode","animClip","AnimationClip","curCreateIndex","curHeight","curPlayIndex","onLoad","y","initData","startTime","Date","getTime","registerTouchEvent","start","update","passTime","passHeight","gameData","maxHeiht","maxIndex","Math","ceil","length","push","apply","originalData","index","node","createBrickLine","addChild","onDestroy","gameAddData","count","floor","random","isPlay","initRes","nNum","bid","noBrickId","brickLine","instantiate","getChildByName","active","self","began","event","posX","touch","getLocation","x","touchId","clearBrick","runBrickAnimation","on","play","nTouchId","nCurPlayId","ret","isBreak","isAdd","line","addBrick","curData","brickId","wayId","Number","replace","toString","callback","jtNode","moveHeight","at","moveUp","moveBy","p","cf_runEffect","callFunc","pNode","removeFromParent","seq","sequence","runAction","idList","removeChildByTag","addComponent","Sprite","anim","Animation","clip","name","addClip"],"mappings":"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","file":"Xiaozhuankuai.js","sourceRoot":"../../../../../../../../assets/resources/Script/view/games/Xiaozhuankuai","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar config = require(\"config\");\n\n// 速度/s\nvar m_speed = 100;\n// 四条格的宽度\nvar m_spaceX = cc.winSize.width / 8;\n// 每一行的高度\nvar m_spaceY = 100;\n// 起始高度\nvar m_startHeight = 0;\n\n\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n        // 破碎砖块资源\n        sfBrickBreak: cc.SpriteFrame,\n        brickLine1: cc.Prefab,\n        brickLine2: cc.Prefab,\n        quantao: cc.Prefab,\n        spriteBg: cc.Node,\n\n        dandao1: cc.Node,\n        dandao2: cc.Node,\n        dandao3: cc.Node,\n        dandao4: cc.Node,\n        scrollNode: cc.Node,\n        timer: cc.Button,\n        playNode: cc.Node,\n        animClip: cc.AnimationClip,\n\n        // 定义变量\n        curCreateIndex: 0,\n        curHeight: 0,\n        curPlayIndex: 0,\n\n\n\n    },\n\n    onLoad() {\n\n        // 设置滚动节点的 初始高度\n        this.scrollNode.y = m_startHeight;\n\n        this.initData();\n\n        this.startTime = new Date().getTime();\n\n        this.registerTouchEvent();\n    },\n    start() {\n\n    },\n\n    update() {\n\n        if (this.startTime) {\n\n            var passTime = (new Date().getTime() - this.startTime) / 1000;\n            var passHeight = passTime * m_speed;\n            this.curHeight = m_startHeight - passHeight;\n            this.scrollNode.y = this.curHeight;\n        }\n\n        if (this.gameData) {\n            // 默认添加行数\n            var maxHeiht = m_startHeight - this.scrollNode.y + 10 * m_spaceY;\n            var maxIndex = Math.ceil(maxHeiht / m_spaceY);\n            if (maxIndex > this.gameData.length) {\n                this.gameData.push.apply(this.gameData, this.originalData);\n            }\n            if (this.curCreateIndex < maxIndex) {\n                for (let index = this.curCreateIndex; index < maxIndex; index++) {\n                    if (this.gameData[index]) {\n                        var node = this.createBrickLine(this.gameData[index]);\n                        node.y = index * m_spaceY;\n                        this.scrollNode.addChild(node, 0, index);\n                    }\n                }\n                this.curCreateIndex = maxIndex;\n            }\n        }\n\n    },\n\n    onDestroy() {\n\n    },\n\n    /**\n     * 初始化数据\n     */\n    initData() {\n        // if (!config.isNetwork) {\n        this.gameData = [null, null, null, null, null, null, null, null];\n        this.gameAddData = [];\n        this.originalData = []\n        var count = 100;\n        for (let index = 0; index < count; index++) {\n            this.originalData[index] = Math.floor(Math.random() * 10 % 4 + 1) * 10 + (Math.random() < 0.5 ? 5 : 6);\n        }\n        this.isPlay = true;\n        // }\n        this.curPlayIndex = this.gameData.length;\n        this.gameData.push.apply(this.gameData, this.originalData);\n    },\n\n    /**\n     * 加载资源\n     */\n    initRes() {\n\n    },\n\n\n    /**\n     * 创建 一行砖块 \n     * @param {*} nNum 一行的砖块数据，15，16，\n     */\n    createBrickLine(nNum) {\n        var bid = nNum % 10;\n        var noBrickId = (nNum - bid) / 10;\n        var brickLine = cc.instantiate(bid == 5 ? this.brickLine1 : this.brickLine2);\n        brickLine.getChildByName(\"brick\" + noBrickId).active = false;\n        return brickLine;\n    },\n\n    // 注册监听\n    registerTouchEvent() {\n        var self = this;\n        var began = function (event) {\n            if (this.isPlay) {\n                // this.isPlay = false;\n                var posX = event.touch.getLocation().x;\n                var touchId = Math.ceil(posX / (cc.winSize.width / 4));\n\n                // 计算消除的行数\n                this.clearBrick(touchId, function () {\n                    self.runBrickAnimation();\n                });\n            }\n        };\n        this.spriteBg.on(\"touchstart\", began, this);\n    },\n\n    /**\n     * 计算消除的行数\n     * @param {*} touchId 点击的行数\n     */\n    play(nTouchId, nCurPlayId) {\n        var ret = {\n            isBreak: false,\n            isAdd: false,\n        };\n\n        var line = [];\n        var addBrick=[];\n        for (let index = nCurPlayId; index < this.gameData.length; index++) {\n            \n            var curData = this.gameData[index];\n            if(!curData){\n                line.push(index);\n            }\n            \n            var brickId = curData % 10;\n            var wayId = (curData - brickId) / 10;\n\n            \n            //消除\n            if (wayId == nTouchId && (!ret.isAdd)) {\n                line.push(index);\n                this.curPlayIndex = index + 1;\n                if (brickId == 6) {\n                    ret.isBreak = true;\n                    break;\n                }\n            } else {//添加元素\n                if (nCurPlayId == index) {\n                    ret.isAdd = true;\n                    if(curData<100){\n                        this.gameData[index-1]= Number(\"12345\").replace(wayId,\"\");\n                        addBrick.push([index-1,wayId]);\n                        this.curPlayIndex = index-1;\n                    }else{\n                        this.gameData[index] = Number(curData.toString()).replace(wayId,\"\");\n                    }\n                    \n                    break;\n                }else{\n                    if(ret.isAdd){\n                        if (wayId == nTouchId){\n\n                        }\n                    }\n                    break;\n                }\n                \n            }\n        }\n        ret.line = line;\n\n        return ret\n    },\n\n    //消除砖块\n    clearBrick(touchId, callback) {\n        var self = this;\n\n        var jtNode = cc.instantiate(this.quantao);\n        this.playNode.addChild(jtNode);\n        jtNode.x = (2 * touchId - 1) * m_spaceX;\n\n        self[\"dandao\" + touchId].active = true;\n        // 计算上升高度\n        var moveHeight = 200;\n        var at = 0.00025 * moveHeight;\n        var moveUp = cc.moveBy(at, cc.p(0, moveHeight))\n        var cf_runEffect = cc.callFunc(function (pNode) {\n            self[\"dandao\" + touchId].active = false;\n            pNode.removeFromParent();\n            if (callback) {\n                callback();\n            }\n        });\n        var seq = cc.sequence(moveUp, cf_runEffect);\n        jtNode.runAction(seq);\n    },\n\n    // 消除动画\n    runBrickAnimation(idList, callback) {\n\n        for (let index = 0; index < idList.length; index++) {\n            this.scrollNode.removeChildByTag(idList[index]);\n            var node = new cc.Node();\n            node.addComponent(cc.Sprite);\n            this.scrollNode.addChild(node, 0, idList[index]);\n\n            node.x = cc.winSize.width / 2;\n            node.y = index * m_spaceY;\n\n            var anim = node.addComponent(cc.Animation);\n            // 注册\n            anim.on('finished', function () {\n                this.scrollNode.removeChildByTag(idList[index]);\n                if (callback) {\n                    callback();\n                }\n            }, this);\n\n            var clip = this.animClip;\n            clip.name = \"run\";\n            anim.addClip(clip);\n            anim.play('run');\n        }\n    },\n\n});\n"]}