{"version":3,"sources":["Ready.js"],"names":["onfire","require","requestHandler","HallData","tools","events","scenes","config","texts","globalData","that","cc","Class","extends","Component","properties","bgSprite","Node","actionFrame","SpriteFrame","tipLabel","Label","myHead","Sprite","myHeadContainer","myName","opHead","opHeadContainer","opName","vs","vsAni","Animation","btnCancel","Button","onLoad","on","hall","S2C_READY_OPPONENT","onReceive_otherReady","start","createReadyAction","loadRemoteImage","getUserInfo","icon","isTest","schedule","data","otherIcon","otherName","stopReadyAction","at","node","btn","addComponent","self","addChild","y","wave","waveSprite","spriteFrame","scale","scaleAction","scaleTo","fadeOut","spawn","cf_scale","callFunc","opacity","seq","sequence","repeat","repeatForever","runAction","removeChildByTag","onClickBtnCancel","console","log","appId","getCurGameInfo","token","myUserInfo","sendRequest","C2S_CANCEL_MATCH","director","loadScene","HALL","fire","HALL_DATA","rawData","data1","data2","JSON","stringify","active","string","ready","MATCHED","name","play","moveTo","scheduleOnce","curGameInfo","game","S2C_LOGIN","scene","GAME_DATA","un","roomKey","myCode","C2S_LOGIN","onDestroy","READY_LOADED"],"mappings":"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","file":"Ready.js","sourceRoot":"../../../../../../../assets/resources/Script/view/hall","sourcesContent":["var onfire = require(\"onfire\"); //处理事件的类库\r\nvar requestHandler = require(\"RequestHandler\");\r\nvar HallData = require(\"HallData\");\r\nvar tools = require(\"Tools\");\r\nvar events = require(\"CustomEvents\");\r\nvar scenes = require(\"SceneList\");\r\nvar config = require(\"config\");\r\nvar texts = require(\"Text\");\r\nvar globalData = require(\"Global\");\r\nvar that;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        bgSprite: cc.Node,\r\n        actionFrame: cc.SpriteFrame,\r\n\r\n        // 提示文字\r\n        tipLabel: cc.Label,\r\n\r\n        // 我的头像\r\n        myHead: cc.Sprite,\r\n        myHeadContainer: cc.Node,\r\n        myName: cc.Label,\r\n\r\n        // 对手的头像\r\n        opHead: cc.Sprite,\r\n        opHeadContainer: cc.Node,\r\n        opName: cc.Label,\r\n\r\n        // VS\r\n        vs: cc.Node,\r\n        vsAni: cc.Animation,\r\n\r\n        // 退出按钮\r\n        btnCancel: cc.Button,\r\n    },\r\n\r\n    onLoad() {\r\n        // 创建监听\r\n        onfire.on(events.hall.S2C_READY_OPPONENT, this.onReceive_otherReady);\r\n\r\n        that = this;\r\n    },\r\n\r\n    start() {\r\n        this.createReadyAction();\r\n\r\n        // 我的头像\r\n        tools.loadRemoteImage(HallData.getUserInfo().icon, this.myHead);\r\n\r\n        // 本地测试\r\n        if (config.isTest) {\r\n            this.schedule(function() {\r\n                var data = {\r\n                    otherIcon: HallData.getUserInfo().icon,\r\n                    otherName: \"测试用户\",\r\n                };\r\n                this.onReceive_otherReady(data, {});\r\n            }, 2);\r\n        }\r\n    },\r\n\r\n    // 创建匹配动画\r\n    createReadyAction() {\r\n\r\n        this.stopReadyAction();\r\n        var at = 3;\r\n        var node = new cc.Node();\r\n        var btn = node.addComponent(cc.Button);\r\n        var self = this;\r\n        this.bgSprite.addChild(node, 0, 1001);\r\n        node.y = -50;\r\n\r\n        btn.schedule(function() {\r\n            var wave = new cc.Node();\r\n            node.addChild(wave);\r\n            var waveSprite = wave.addComponent(cc.Sprite);\r\n            waveSprite.spriteFrame = self.actionFrame;\r\n\r\n            wave.scale = 0.1;\r\n            // 放大倍数\r\n            var scaleAction = cc.scaleTo(3, 1);\r\n            var fadeOut = cc.fadeOut(3);\r\n            var spawn = cc.spawn(scaleAction, fadeOut);\r\n            var cf_scale = cc.callFunc(function() {\r\n                wave.scale = 0.1;\r\n                wave.opacity = 255\r\n            })\r\n            var seq = cc.sequence(spawn, cf_scale);\r\n            var repeat = cc.repeatForever(seq)\r\n            wave.runAction(repeat);\r\n        }, 1, 3, 0.1);\r\n\r\n    },\r\n\r\n    //停止动画\r\n    stopReadyAction() {\r\n        this.bgSprite.removeChildByTag(1001);\r\n    },\r\n\r\n    // 返回大厅\r\n    onClickBtnCancel() {\r\n        console.log(\"取消匹配\");\r\n        var data = {\r\n            appId: HallData.getCurGameInfo().appId,\r\n            token: globalData.myUserInfo.token,\r\n        };\r\n        requestHandler.sendRequest(events.hall.C2S_CANCEL_MATCH, data);\r\n        cc.director.loadScene(scenes.hall.HALL, function() {\r\n            onfire.fire(events.hall.HALL_DATA, HallData.rawData);\r\n        });\r\n    },\r\n\r\n    // 对手准备完成\r\n    onReceive_otherReady(data1, data2) {\r\n        console.log(\"otherReady:\", JSON.stringify(data1));\r\n\r\n        // 禁止取消\r\n        that.btnCancel.node.active = false;\r\n\r\n        // 文字\r\n        that.tipLabel.string = texts.ready.MATCHED;\r\n        that.myName.string = HallData.getUserInfo().name;\r\n        that.opName.string = data1.otherName;\r\n\r\n        // 对手头像\r\n        tools.loadRemoteImage(data1.otherIcon, that.opHead);\r\n\r\n        // 动画效果\r\n        that.vsAni.play();\r\n        that.stopReadyAction();\r\n        that.myHeadContainer.runAction(cc.moveTo(0.6, 150, 774));\r\n        that.scheduleOnce(function() {\r\n            that.opHeadContainer.runAction(cc.moveTo(0.6, 500, 774))\r\n        }, 0.5);\r\n        that.scheduleOnce(function() {\r\n            that.vs.active = true\r\n        }, 1);\r\n\r\n        // 进入房间\r\n        that.scheduleOnce(function() {\r\n            console.log(\"--onReceive_otherReady\");\r\n            var curGameInfo = HallData.getCurGameInfo()\r\n            onfire.on(events.game.S2C_LOGIN, function(data1, data2) {\r\n                console.log(\"s_game_login=====\", data1);\r\n                // 切换场景\r\n                console.log(\"------ login: \", curGameInfo.scene);\r\n                cc.director.loadScene(curGameInfo.scene, function() {\r\n                    onfire.fire(events.game.GAME_DATA, data1, data2);\r\n                });\r\n                onfire.un(events.game.S2C_LOGIN);\r\n            });\r\n\r\n            var data = {\r\n                //appId:curGameInfo.appId,\r\n                roomKey: data1.roomKey,\r\n                myCode: data1.myCode,\r\n            };\r\n            requestHandler.sendRequest(events.game.C2S_LOGIN, data);\r\n        }, 2.5);\r\n    },\r\n\r\n    onDestroy() {\r\n        onfire.un(events.hall.S2C_READY_OPPONENT);\r\n        onfire.un(events.hall.READY_LOADED);\r\n    }\r\n});"]}