{"version":3,"sources":["Hall_old.js"],"names":["onfire","require","requestHandler","HallData","config","events","consts","scenes","tools","globalData","cc","Class","extends","Component","properties","btnPk","Button","btnGame","btnMeet","pkLayer","Node","gameLayer","meetLayer","gameScrollContent","btnBack","onBackClick","customEventData","disableAutoLogin","director","loadScene","hall","LOGIN_SCENE","onLoad","$this","console","log","on","HALL_DATA","data1","data2","setHallData","un","listenerList","S2C_READY_ME","onReceive_myReady","S2C_READY_OPPONENT","onReceive_otherReady","forEach","element","isNetwork","gameInfoList","preloadScene","READY","onDestroy","success","curGameInfo","getCurGameInfo","game","S2C_LOGIN","scene","fire","GAME_DATA","data","roomKey","myCode","sendRequest","C2S_LOGIN","onChangeLayer","event","active","hallData","rawData","setGameList","setUserInfo","userInfo","updateGameLayer","pGameData","spaceHeight","height","Math","ceil","length","onResourceLoaded","errorMessage","loadedResource","Prefab","index","posX","posY","floor","gamePrefab","instantiate","setPosition","addChild","script","getComponent","updateItem","loader","loadRes"],"mappings":"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","file":"Hall_old.js","sourceRoot":"../../../../../../../assets/resources/Script/view/hall","sourcesContent":["var onfire = require(\"onfire\"); //处理事件的类库\r\nvar requestHandler = require(\"RequestHandler\");\r\nvar HallData = require(\"HallData\");\r\nvar config = require(\"config\");\r\nvar events = require(\"CustomEvents\");\r\nvar consts = require(\"Constants\");\r\nvar scenes = require(\"SceneList\");\r\nvar tools = require(\"Tools\");\r\nvar globalData = require(\"Global\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 底部按钮\r\n        btnPk: cc.Button,\r\n        btnGame: cc.Button,\r\n        btnMeet: cc.Button,\r\n        // pk界面，游戏界面，约战界面\r\n        pkLayer: cc.Node,\r\n        gameLayer: cc.Node,\r\n        meetLayer: cc.Node,\r\n\r\n        // 游戏界面元素\r\n        gameScrollContent: cc.Node,\r\n\r\n        // 后退按钮\r\n        btnBack: cc.Button,\r\n    },\r\n\r\n    onBackClick: function(customEventData) {\r\n        globalData.disableAutoLogin = true;\r\n        cc.director.loadScene(scenes.hall.LOGIN_SCENE);\r\n    },\r\n\r\n    onLoad() {\r\n        var $this = this;\r\n        console.log(\"------- onLoad\");\r\n        onfire.on(events.hall.HALL_DATA, function(data1, data2) {\r\n            $this.setHallData(data1);\r\n            onfire.un(events.hall.HALL_DATA);\r\n        });\r\n\r\n        // 创建监听\r\n        var listenerList = [\r\n            [events.hall.S2C_READY_ME, $this.onReceive_myReady, $this],\r\n            [events.hall.S2C_READY_OPPONENT, $this.onReceive_otherReady, $this],\r\n        ];\r\n        listenerList.forEach(element => {\r\n            onfire.on(element[0], element[1], element[2]);\r\n        });\r\n\r\n        if (!config.isNetwork) {\r\n            $this.setHallData({\r\n                gameInfoList: config.gameInfoList\r\n            });\r\n        }\r\n\r\n        // 预加载匹配场景\r\n        cc.director.preloadScene(scenes.hall.READY);\r\n    },\r\n\r\n    // 销毁时调用\r\n\r\n    onDestroy() {\r\n        // 创建监听\r\n        var listenerList = [\r\n            [events.hall.S2C_READY_ME],\r\n            [events.hall.S2C_READY_OPPONENT],\r\n        ];\r\n        // 移除监听\r\n        listenerList.forEach(element => {\r\n            onfire.un(element[0]);\r\n        });\r\n    },\r\n    // start () {  \r\n    // },\r\n\r\n    // 我的准备结果\r\n    onReceive_myReady(data1, data2) {\r\n        console.log(\"--onReceive_myReady\");\r\n        // success:int \t\t描述：0为成功，其他为错误码\r\n        if (data1.success == 0) {\r\n\r\n            // TODO 进入匹配界面\r\n            cc.director.loadScene(scenes.hall.READY);\r\n\r\n        } else {\r\n            console(\"s_daTing_myReady:success==\", data1.success);\r\n            //cc.director.loadScene(\"ready\");\r\n        }\r\n\r\n    },\r\n    // 别人的准备结果\r\n    onReceive_otherReady(data1, data2) {\r\n        console.log(\"--onReceive_otherReady\");\r\n        // otherName:string \t\t描述：用户名称\r\n        // otherIcon:string\t\t\t描述：头像\r\n        // otherSex:int\t\t\t\t描述：性别男0女1\r\n        // myCode:string\t\t\t描述：自己游戏验证码\r\n        // ip:string\t\t\t    描述：游戏服地址\r\n        // port:int\t\t\t        描述：游戏服端口\r\n        var curGameInfo = HallData.getCurGameInfo()\r\n\r\n        onfire.on(events.game.S2C_LOGIN, function(data1, data2) {\r\n            console.log(\"s_game_login=====\", data1);\r\n            // 切换场景\r\n            console.log(\"------ login: \", curGameInfo.scene);\r\n            cc.director.loadScene(curGameInfo.scene, function() {\r\n                onfire.fire(events.game.GAME_DATA, data1, data2);\r\n            });\r\n            onfire.un(events.game.S2C_LOGIN);\r\n        });\r\n\r\n        var data = {\r\n            // appId:curGameInfo.appId,\r\n            roomKey: data1.roomKey,\r\n            myCode: data1.myCode\r\n        };\r\n        requestHandler.sendRequest(events.game.C2S_LOGIN, data);\r\n\r\n    },\r\n\r\n    // 切换界面\r\n    onChangeLayer: function(event, customEventData) {\r\n        this.gameLayer.active = customEventData == 1;\r\n        this.pkLayer.active = customEventData == 2;\r\n        this.meetLayer.active = customEventData == 3;\r\n    },\r\n\r\n    // 获取大厅数据\r\n    setHallData: function(hallData) {\r\n        this.hallData = hallData;\r\n        HallData.rawData = hallData;\r\n        HallData.setGameList(this.hallData.gameInfoList);\r\n        console.log(this.hallData.gameInfoList);\r\n        HallData.setUserInfo(this.hallData.userInfo);\r\n\r\n        this.updateGameLayer(this.hallData.gameInfoList);\r\n    },\r\n\r\n    // 更新游戏界面数据\r\n    updateGameLayer: function(pGameData) {\r\n        console.log(\"---- updateGameLayer:\", pGameData);\r\n        var spaceHeight = 280\r\n        this.gameScrollContent.height = Math.ceil(pGameData.length / 3) * spaceHeight + 20\r\n\r\n        var $this = this;\r\n        var onResourceLoaded = function(errorMessage, loadedResource) {\r\n            //检查失败原因\r\n            if (errorMessage) {\r\n                cc.log('加载失败, 原因:' + errorMessage);\r\n                return;\r\n            }\r\n            if (!(loadedResource instanceof cc.Prefab)) {\r\n                cc.log('类型不对！');\r\n                return;\r\n            } //這個是型別的檢查\r\n\r\n            for (let index = 0; index < pGameData.length; index++) {\r\n                const element = pGameData[index];\r\n\r\n                var posX = (index % 3 + 0.5) * 213;\r\n                var posY = (Math.floor(index / 3)) * -spaceHeight - 150;\r\n                // console.log(posX,posY,element.gameId);\r\n                //接著，我們就可以進行實例化了\r\n                var gamePrefab = cc.instantiate(loadedResource);\r\n                gamePrefab.setPosition(posX, posY);\r\n                $this.gameScrollContent.addChild(gamePrefab);\r\n\r\n                var script = gamePrefab.getComponent('GameItem');\r\n                script.updateItem(element);\r\n            }\r\n        };\r\n        //這邊才是真的使用cc.loader進行載入，並且呼叫我們上面寫的方法\r\n        cc.loader.loadRes(\"prefabs/pb_game\", onResourceLoaded);\r\n    },\r\n\r\n\r\n});"]}