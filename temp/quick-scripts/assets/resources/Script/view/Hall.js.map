{"version":3,"sources":["Hall.js"],"names":["self","serverConnect","require","requestHandler","onfire","events","GameData","cc","Class","extends","Component","properties","labelNotice","Label","labelName","labelPlayerId","labelScore","btnRoom_niuniu","Button","btnJoinRoom","onLoad","connect","on","OPEN","onServerConnectOpen","ERROR","onServerConnectError","start","onDestroy","obj","console","log","JSON","stringify","un","hall","S2C_LOGIN","data1","data2","setUserInfo","userInfo","url","window","location","href","argsObj","getUrlArgs","data","loginId","Date","getTime","sendRequest","C2S_LOGIN","indexOf","arr","split","theRequest","Object","i","length","kye","value","joinRoom","onResourceLoaded","errorMessage","loadedResource","Prefab","gamePrefab","instantiate","node","addChild","loader","loadRes","string","name","uid","score"],"mappings":"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","file":"Hall.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\Script\\view","sourcesContent":["\r\nvar self;\r\nvar serverConnect = require(\"ServerConnect\");\r\nvar requestHandler = require(\"RequestHandler\");\r\nvar onfire = require(\"onfire\");\r\nvar events = require(\"CustomEvents\");\r\nvar GameData = require(\"GameData\")\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n        labelNotice: cc.Label,\r\n        labelName: cc.Label,\r\n        labelPlayerId: cc.Label,\r\n        labelScore: cc.Label,\r\n\r\n        btnRoom_niuniu: cc.Button,\r\n        btnJoinRoom: cc.Button,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        self = this;\r\n\r\n        serverConnect.connect(true);\r\n        onfire.on(events.onfire.OPEN, this.onServerConnectOpen);\r\n        onfire.on(events.onfire.ERROR, this.onServerConnectError);\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    start() {\r\n\r\n        // var data = {\r\n        //     name: \"唱山歌\",\r\n        //     playerId: 123,\r\n        //     notice: \"我是公告！\",\r\n        //     score: 23422,\r\n        // }\r\n        // self.setUserInfo(data)\r\n    },\r\n\r\n    onDestroy() {\r\n\r\n    },\r\n\r\n    onServerConnectError: function(obj) {\r\n        console.log(JSON.stringify(obj));\r\n    },\r\n\r\n    onServerConnectOpen: function() {\r\n        console.log(\"server connected\");\r\n        onfire.un(events.onfire.OPEN);\r\n\r\n        onfire.on(events.hall.S2C_LOGIN, function(data1, data2) {\r\n            console.log(\"s_game_login=====\", data1);\r\n            GameData.setUserInfo(data1.userInfo);\r\n            self.setUserInfo(data1.userInfo)\r\n            onfire.un(events.hall.S2C_LOGIN);\r\n        });\r\n\r\n        var url=window.location.href;  \r\n        var argsObj = self.getUrlArgs(url); \r\n\r\n        var data = {\r\n            loginId:argsObj.loginId || new Date().getTime()%1000\r\n        };\r\n        requestHandler.sendRequest(events.hall.C2S_LOGIN, data);\r\n    },\r\n\r\n    /**\r\n     * 获取url参数\r\n     * @param {string} url \r\n     */\r\n    getUrlArgs(url){\r\n        if(!url || url==\"\" || url.indexOf(\"?\")==-1){\r\n            return {}\r\n        }\r\n        var arr = url.split('?')[1].split('&')\r\n        var theRequest = new Object();\r\n        for (var i = 0; i < arr.length; i++) {\r\n            var kye = arr[i].split(\"=\")[0]\r\n            var value = arr[i].split(\"=\")[1]\r\n            // 给对象赋值\r\n            theRequest[kye] = value\r\n        }\r\n        return theRequest;\r\n    },\r\n    joinRoom() {\r\n        var onResourceLoaded = function(errorMessage, loadedResource) {\r\n            //检查失败原因\r\n            if (errorMessage) {\r\n                cc.log('加载失败, 原因:' + errorMessage);\r\n                return;\r\n            }\r\n            if (!(loadedResource instanceof cc.Prefab)) {\r\n                cc.log('类型不对！');\r\n                return;\r\n            } //這個是型別的檢查\r\n\r\n            //接著，我們就可以進行實例化了\r\n            var gamePrefab = cc.instantiate(loadedResource);\r\n            self.node.addChild(gamePrefab);\r\n            \r\n        };\r\n        //這邊才是真的使用cc.loader進行載入，並且呼叫我們上面寫的方法\r\n        cc.loader.loadRes(\"Prefab/join_room\", onResourceLoaded);\r\n    },\r\n\r\n    /**\r\n     * 设置用户信息\r\n     * @param {*} data \r\n     */\r\n    setUserInfo(data) {\r\n        self.labelName.string = data.name;\r\n        self.labelPlayerId.string = data.uid;\r\n        // self.labelNotice.string = data.notice;\r\n        self.labelScore.string = data.score;\r\n    }\r\n});\r\n"]}