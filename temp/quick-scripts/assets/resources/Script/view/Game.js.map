{"version":3,"sources":["Game.js"],"names":["self","requestHandler","require","onfire","events","GameData","cc","Class","extends","Component","properties","playerNode","Node","seatNode","btnReady","onLoad","userInfo","getUserInfo","roomCode","getRoomCode","initWidget","listenerList","hall","HALL_DATA","onReceive_login","game","S2C_SEAT_CHOOSE","onReceive_sitDown","S2C_SYN_SEATS","onReceive_syn_seat","S2C_READY","onReceive_Ready","forEach","on","element","players","seats","index","getChildByName","getComponent","active","data","console","log","un","sitDown","event","seatId","Number","mySeatId","sitUp","roomNo","sendRequest","C2S_SEAT_CHOOSE","list","seatPlayers","seatIndex","create","indexOf","splice","sendReady","C2S_READY","result"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../../../assets/resources/Script/view","sourcesContent":["var self;\nvar requestHandler = require(\"RequestHandler\");\nvar onfire = require(\"onfire\");\nvar events = require(\"CustomEvents\");\nvar GameData = require(\"GameData\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        playerNode: cc.Node,\n        seatNode: cc.Node,\n        btnReady: cc.Node,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n        self = this;\n        self.userInfo = GameData.getUserInfo();\n        self.roomCode = GameData.getRoomCode();\n        // 初始化控件\n        self.initWidget()\n        // 设置监听\n        var listenerList = [\n            [events.hall.HALL_DATA, this.onReceive_login, this],\n            [events.game.S2C_SEAT_CHOOSE, this.onReceive_sitDown, this],\n            [events.game.S2C_SYN_SEATS, this.onReceive_syn_seat, this],\n            [events.game.S2C_READY, this.onReceive_Ready, this],\n            // [events.game.tiaoyitiao.S2C_GAMEOVER, this.onReceive_overGame, this],\n        ]\n        listenerList.forEach(element => {\n            onfire.on(element[0], element[1], element[2]);\n        });\n\n    },\n\n    /**\n     * 初始化控件\n     */\n    initWidget() {\n        // 玩家\n        self.players = [];\n        // 座位\n        self.seats = [];\n        for (let index = 1; index < 13; index++) {\n            // 设置玩家\n            self.players[index] = self.playerNode.getChildByName(\"player\" + index).getComponent(\"Player\");\n            // 设置座位\n            self.seats[index] = self.seatNode.getChildByName(\"site\" + index)\n        }\n\n        self.btnReady.active = false;\n    },\n\n    /**\n     * 登录返回结果\n     * @param {*} data \n     */\n    onReceive_login(data) {\n        console.log(\"进入游戏，接受数据：\", data)\n        self.userInfo = data.userInfo;\n        onfire.un(events.hall.HALL_DATA);\n    },\n    /**\n     * 坐下\n     * @param {*} seatId \n     */\n    sitDown(event, seatId) {\n        seatId = Number(seatId);\n        if (self.mySeatId) {\n            // self.seats[self.mySeatId].active = true;\n            self.players[self.mySeatId].sitUp()\n        }\n\n        self.mySeatId = seatId;\n        console.log(\"选择座位：\", seatId);\n        var data = {\n            roomNo: self.roomCode,\n            seatId: seatId\n        }\n        requestHandler.sendRequest(events.game.C2S_SEAT_CHOOSE, data);\n    },\n\n    /**\n     * 收到坐下回调\n     * @param {*} data \n     */\n    onReceive_sitDown(data) {\n        // self.seats[self.mySeatId].active = false;\n        // self.players[self.mySeatId].create(self.userInfo)\n        console.log(\"坐下返回：\", data);\n        self.btnReady.active = true;\n    },\n\n    /**\n     * 同步坐下情况\n     * @param {*} data \n     */\n    onReceive_syn_seat(data) {\n        console.log(\"同步坐下玩家信息：\", data);\n        var list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n        data.seatPlayers.forEach(element => {\n            // 显示玩家数据\n            var seatId = element.seatIndex\n            self.players[seatId].create(element)\n            // 隐藏坐下按钮\n            self.seats[self.mySeatId].active = false;\n            var index = list.indexOf(seatId);\n            list.splice(index, 1);\n        });\n\n        // 显示其他 坐下按钮\n        list.forEach(element => {\n            self.seats[element].active = true;\n        });\n    },\n\n    sendReady() {\n        var data = {\n            roomNo: self.roomCode,\n            seatId: self.mySeatId\n        }\n        requestHandler.sendRequest(events.game.C2S_READY, data);\n\n    },\n\n    onReceive_Ready(data) {\n        if (data.result == 0) {\n            self.btnReady.active = false;\n        }\n    }\n});\n"]}