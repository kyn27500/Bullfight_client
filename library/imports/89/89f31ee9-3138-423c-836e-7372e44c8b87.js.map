{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\resources\\Script\\network/assets\\resources\\Script\\network\\ServerConnect.js"],"names":["onfire","require","serverConfig","events","ServerConnect","_sock","connect","reset","readyState","console","log","close","WebSocket","serverHost","serverPort","onopen","_onOpen","bind","onclose","_onClose","onmessage","_onMessage","onerror","_onError","error","fire","OPEN","err","CLOSE","obj","MESSAGE","ERROR","send","msg","module","exports"],"mappings":";;;;;;AAAA,IAAIA,SAASC,QAAQ,QAAR,CAAb,EAAgC;AAChC,IAAIC,eAAeD,QAAQ,cAAR,CAAnB;AACA,IAAIE,SAASF,QAAQ,cAAR,CAAb;;AAEA,IAAIG,gBAAgB;AAChB;AACAC,WAAO,IAFS;;AAIhB;;;;AAIAC,aAAS,mBAAwB;AAAA,YAAfC,KAAe,uEAAP,KAAO;;AAC7B,YAAIA,SAAS,KAAKF,KAAL,CAAWG,UAAX,KAA0B,CAAvC,EAA0C;AACtCC,oBAAQC,GAAR,CAAY,8BAAZ;AACA,gBAAI,KAAKL,KAAT,EAAe;AACX,qBAAKM,KAAL;AACH;AACD,iBAAKN,KAAL,GAAa,IAAIO,SAAJ,CAAcV,aAAaW,UAAb,GAA0B,GAA1B,GAAgCX,aAAaY,UAA3D,CAAb;AACA,iBAAKT,KAAL,CAAWU,MAAX,GAAoB,KAAKC,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAApB;AACA,iBAAKZ,KAAL,CAAWa,OAAX,GAAqB,KAAKC,QAAL,CAAcF,IAAd,CAAmB,IAAnB,CAArB;AACA,iBAAKZ,KAAL,CAAWe,SAAX,GAAuB,KAAKC,UAAL,CAAgBJ,IAAhB,CAAqB,IAArB,CAAvB;AACA,iBAAKZ,KAAL,CAAWiB,OAAX,GAAqB,KAAKC,QAAL,CAAcN,IAAd,CAAmB,IAAnB,CAArB;AACH;AACD,eAAO,IAAP;AACH,KArBe;;AAuBhB;;;AAGAN,WAAO,iBAAW;AACdF,gBAAQC,GAAR,CAAY,8BAAZ;AACA,YAAI;AACA,iBAAKL,KAAL,CAAWM,KAAX;AACH,SAFD,CAEE,OAAOa,KAAP,EAAc;AACZf,oBAAQC,GAAR,CAAY,QAAZ,EAAsBc,KAAtB;AACH;AACJ,KAjCe;;AAmChBR,aAAS,mBAAW;AAChBhB,eAAOyB,IAAP,CAAYtB,OAAOH,MAAP,CAAc0B,IAA1B;AACH,KArCe;AAsChBP,cAAU,kBAASQ,GAAT,EAAc;AACpB3B,eAAOyB,IAAP,CAAYtB,OAAOH,MAAP,CAAc4B,KAA1B,EAAiCD,GAAjC;AACH,KAxCe;AAyChBN,gBAAY,oBAASQ,GAAT,EAAc;AACtB7B,eAAOyB,IAAP,CAAYtB,OAAOH,MAAP,CAAc8B,OAA1B,EAAmCD,GAAnC;AACH,KA3Ce;AA4ChBN,cAAU,kBAASM,GAAT,EAAc;AACpB7B,eAAOyB,IAAP,CAAYtB,OAAOH,MAAP,CAAc+B,KAA1B,EAAiCF,GAAjC;AACH,KA9Ce;;AAgDhBG,UAAM,cAASC,GAAT,EAAc;AAChB,aAAK5B,KAAL,CAAW2B,IAAX,CAAgBC,GAAhB;AACH;AAlDe,CAApB;;AAqDAC,OAAOC,OAAP,GAAiB/B,aAAjB","file":"ServerConnect.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\Script\\network","sourcesContent":["var onfire = require(\"onfire\"); // 处理事件的类库\r\nvar serverConfig = require('ServerConfig');\r\nvar events = require(\"CustomEvents\");\r\n\r\nvar ServerConnect = {\r\n    // 当前的webSocket的对象\r\n    _sock: null,\r\n\r\n    /**\r\n     * 建立连接\r\n     * @param {boolean} reset 是否重置现有连接\r\n     */\r\n    connect: function(reset = false) {\r\n        if (reset || this._sock.readyState !== 1) {\r\n            console.log(\"opening server connection...\");\r\n            if (this._sock){\r\n                this.close();\r\n            }\r\n            this._sock = new WebSocket(serverConfig.serverHost + \":\" + serverConfig.serverPort);\r\n            this._sock.onopen = this._onOpen.bind(this);\r\n            this._sock.onclose = this._onClose.bind(this);\r\n            this._sock.onmessage = this._onMessage.bind(this);\r\n            this._sock.onerror = this._onError.bind(this);\r\n        }\r\n        return this;\r\n    },\r\n\r\n    /**\r\n     * 关闭当前连接\r\n     */\r\n    close: function() {\r\n        console.log(\"closing server connection...\")\r\n        try {\r\n            this._sock.close();\r\n        } catch (error) {\r\n            console.log(\"error:\", error)\r\n        }\r\n    },\r\n\r\n    _onOpen: function() {\r\n        onfire.fire(events.onfire.OPEN);\r\n    },\r\n    _onClose: function(err) {\r\n        onfire.fire(events.onfire.CLOSE, err);\r\n    },\r\n    _onMessage: function(obj) {\r\n        onfire.fire(events.onfire.MESSAGE, obj);\r\n    },\r\n    _onError: function(obj) {\r\n        onfire.fire(events.onfire.ERROR, obj);\r\n    },\r\n\r\n    send: function(msg) {\r\n        this._sock.send(msg);\r\n    },\r\n};\r\n\r\nmodule.exports = ServerConnect;"]}