{"version":3,"sources":["../../../../../../assets/resources/Script/view/assets/resources/Script/view/Game.js"],"names":["self","requestHandler","require","onfire","events","GameData","cc","Class","extends","Component","properties","playerNode","Node","seatNode","btnReady","bankerNode","betNode","operation","centerNode","myPlayer","buttonTest","sf_tableAtlas","SpriteAtlas","spStateLabel","Sprite","clockNode","clockLabel","Label","onLoad","userInfo","getUserInfo","roomCode","getRoomCode","initWidget","listenerList","hall","HALL_DATA","onReceive_login","game","S2C_SEAT_CHOOSE","onReceive_sitDown","S2C_SYN_SEATS","onReceive_syn_seat","S2C_READY","onReceive_Ready","S2C_CARDS","onReceive_cards","S2C_GAME_STATE","onReceive_gameState","S2C_ROB_BANKER","onReceive_robBanker","S2C_BET","onReceive_bet","S2C_ROOM_BANKER","onReceive_roomBanker","S2C_LAST_CARD","onReceive_lastCard","S2C_OPEN_CARD","onReceive_openCard","forEach","on","element","players","seats","index","getChildByName","getComponent","myPlayerObj","active","data","console","log","un","sitDown","event","seatId","seatInfo","ready","Number","mySeatId","sitUp","roomNo","sendRequest","C2S_SEAT_CHOOSE","seatPlayers","list","seatIndex","indexOf","splice","uid","user","id","node","create","state","setBetNum","robBankerBet","banker","bet","sendReady","C2S_READY","result","sendCardAction","playerCards","currentGameNum","bankerIndex","myLastCardData","setReady","setBanker","setGameState","onClickForBanker","multiple","betPointQuantity","C2S_ROB_BANKER","onClickForBet","C2S_BET","onClickForOpenCard","C2S_OPEN_CARD","openLastCard","playerCardsSort","lastCard","playerCard","niuType","sortedCards","cards","spriteFrame","_spriteFrames","runClock","nTotalSecond","stopAllActions","string","cf_func","callFunc","delay","delayTime","seq","sequence","rep","repeat","runAction","onClickButtonTest","C2S_RESET_GAMESTATE"],"mappings":"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","file":"Game.js","sourceRoot":"../../../../../../assets/resources/Script/view","sourcesContent":["var self;\nvar requestHandler = require(\"RequestHandler\");\nvar onfire = require(\"onfire\");\nvar events = require(\"CustomEvents\");\nvar GameData = require(\"GameData\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        playerNode: cc.Node,\n        seatNode: cc.Node,\n        btnReady: cc.Node,\n        bankerNode: cc.Node,\n        betNode: cc.Node,\n        operation: cc.Node,\n        centerNode: cc.Node,        //中心点\n        myPlayer: cc.Node,          //我的节点\n        buttonTest: cc.Node,\n\n        sf_tableAtlas: cc.SpriteAtlas, //牌资源\n\n        spStateLabel: cc.Sprite,    //状态描述文字\n        clockNode: cc.Node,          //闹钟节点\n        clockLabel: cc.Label,        //闹钟label\n\n\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n        self = this;\n        self.userInfo = GameData.getUserInfo();\n        self.roomCode = GameData.getRoomCode();\n        // 初始化控件\n        self.initWidget()\n        // 设置监听\n        var listenerList = [\n            [events.hall.HALL_DATA, this.onReceive_login, this],\n            [events.game.S2C_SEAT_CHOOSE, this.onReceive_sitDown, this],\n            [events.game.S2C_SYN_SEATS, this.onReceive_syn_seat, this],\n            [events.game.S2C_READY, this.onReceive_Ready, this],\n            [events.game.S2C_CARDS, this.onReceive_cards, this],\n            [events.game.S2C_GAME_STATE, this.onReceive_gameState, this],\n            [events.game.S2C_ROB_BANKER, this.onReceive_robBanker, this],\n            [events.game.S2C_BET, this.onReceive_bet, this],\n            [events.game.S2C_ROOM_BANKER, this.onReceive_roomBanker, this],\n            [events.game.S2C_LAST_CARD, this.onReceive_lastCard, this],\n            [events.game.S2C_OPEN_CARD, this.onReceive_openCard, this],\n\n\n\n\n        ]\n        listenerList.forEach(element => {\n            onfire.on(element[0], element[1], element[2]);\n        });\n\n    },\n\n    /**\n     * 初始化控件\n     */\n    initWidget() {\n        // 玩家\n        self.players = [];\n        // 座位\n        self.seats = [];\n        for (let index = 1; index < 13; index++) {\n            // 设置玩家\n            self.players[index] = self.playerNode.getChildByName(\"player\" + index).getComponent(\"Player\");\n            // 设置座位\n            self.seats[index] = self.seatNode.getChildByName(\"site\" + index)\n        }\n        self.myPlayerObj = self.myPlayer.getComponent(\"Player\");\n        self.btnReady.active = false;\n\n        // self.players[8].create();\n        // self.players[8].sendCardAction(this.centerNode);\n\n        // self.players[1].create();\n        // self.players[1].sendCardAction(this.centerNode);\n\n        // self.myPlayerObj.create();\n        // self.myPlayerObj.sendCardAction(this.centerNode);\n\n        // self.myPlayerObj.openLastCard([17, 18, 19, 20, 21], 21);\n\n    },\n\n    /**\n     * 登录返回结果\n     * @param {*} data \n     */\n    onReceive_login(data) {\n        console.log(\"进入游戏，接受数据：\", data)\n        self.userInfo = data.userInfo;\n        onfire.un(events.hall.HALL_DATA);\n    },\n    /**\n     * 坐下\n     * @param {*} seatId \n     */\n    sitDown(event, seatId) {\n\n        if (self.seatInfo && !self.seatInfo.ready) {\n            return;\n        }\n        seatId = Number(seatId);\n        if (self.mySeatId) {\n            // self.seats[self.mySeatId].active = true;\n            self.players[self.mySeatId].sitUp()\n        }\n\n        self.mySeatId = seatId;\n        console.log(\"选择座位：\", seatId);\n        var data = {\n            roomNo: self.roomCode,\n            seatId: seatId\n        }\n        requestHandler.sendRequest(events.game.C2S_SEAT_CHOOSE, data);\n    },\n\n    /**\n     * 收到坐下回调\n     * @param {*} data \n     */\n    onReceive_sitDown(data) {\n        // self.seats[self.mySeatId].active = false;\n        // self.players[self.mySeatId].create(self.userInfo)\n        console.log(\"坐下返回：\", data);\n    },\n\n    /**\n     * 同步坐下情况\n     * @param {*} data \n     */\n    onReceive_syn_seat(data) {\n        console.log(\"同步坐下玩家信息：\", data);\n        self.seatPlayers = data.seatPlayers;\n        var list = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]\n        data.seatPlayers.forEach(element => {\n            // 显示玩家数据\n            var seatId = element.seatIndex\n\n            // 隐藏坐下按钮\n            if(self.mySeatId){\n                self.seats[self.mySeatId].active = false;\n            }\n            \n            var index = list.indexOf(seatId);\n            list.splice(index, 1);\n\n            // 复制自己的信息\n            if (self.userInfo.uid == element.user.id) {\n                self.seatInfo = element;\n                self.btnReady.active = !element.ready;\n\n                if (!self.myPlayerObj.node.active) {\n                    self.players[seatId].create(element)\n                }\n                else if (self.state == 2) {\n                    self.myPlayerObj.setBetNum(element.robBankerBet)\n                }\n                else if (self.state == 3 && (!element.banker)) {\n                    self.myPlayerObj.setBetNum(element.bet)\n                }\n                else if (self.state == 6) {\n                    self.myPlayerObj.setBetNum(0)\n                }\n\n\n            } else {\n                if (!self.players[seatId].node.active) {\n                    self.players[seatId].create(element)\n                }\n                else if (self.state == 2) {\n                    self.players[seatId].setBetNum(element.robBankerBet)\n                }\n                else if (self.state == 3 && (!element.banker)) {\n                    self.players[seatId].setBetNum(element.bet)\n                }\n                else if (self.state == 6) {\n                    self.players[seatId].setBetNum(0)\n                }\n\n            }\n        });\n\n        // 显示其他 坐下按钮\n        list.forEach(element => {\n            self.seats[element].active = true;\n        });\n\n\n    },\n\n    sendReady() {\n        var data = {\n            roomNo: self.roomCode,\n            seatId: self.mySeatId\n        }\n        requestHandler.sendRequest(events.game.C2S_READY, data);\n    },\n\n    /**\n     * 准备 返回\n     * @param {*} data \n     */\n    onReceive_Ready(data) {\n        if (data.result == 0) {\n            self.myPlayerObj.create(self.seatInfo);\n            self.players[self.mySeatId].sitUp();\n        }\n    },\n\n    /**\n     *  发送牌数据\n     * @param {*} data \n     */\n    onReceive_cards(data) {\n        console.log(\"发送牌数据：\", data)\n\n        self.seatPlayers.forEach(element => {\n            if (self.userInfo.uid == element.user.id) {\n                self.myPlayerObj.sendCardAction(this.centerNode, data.playerCards)\n\n            } else {\n                self.players[element.seatIndex].sendCardAction(this.centerNode)\n            }\n\n        });\n    },\n\n    /**\n     * 游戏状态值\n     * @param {*} data \n     */\n    onReceive_gameState(data) {\n        console.log(\"游戏状态：\", data.state, data.currentGameNum)\n\n        // 设置状态值\n        self.state = data.state;\n\n        // 座位显示\n        self.seatNode.active = self.state == 0 || self.state == 6;\n        // 抢庄面板显示\n        self.bankerNode.active = self.state == 2;\n        // 下注倍数显示\n        self.betNode.active = self.state == 3 && self.bankerIndex != self.mySeatId;\n        // 摊牌按钮\n        self.operation.active = self.state == 4;\n        //未开始\n        if (data.state == 0) {\n\n            //开始游戏，发牌\n        } else if (data.state == 1) {\n            self.myLastCardData = null;\n\n            // 设置 准备状态消失\n            self.players.forEach(element => {\n                element.setReady(false);\n            });\n            //抢庄\n        } else if (data.state == 2) {\n\n            //普通玩家下注\n        } else if (data.state == 3) {\n            console.log(\"下注按钮：查看自己是否是庄家\", self.seatInfo.banker, self.state == 3 && (!self.seatInfo.banker));\n            //玩家看牌\n        } else if (data.state == 4) {\n\n            //所有人开牌\n        } else if (data.state == 5) {\n\n            //自动准备\n        } else if (data.state == 6) {\n\n            self.players.forEach(element => {\n\n                element.setBanker(false);\n            });\n\n            self.myPlayerObj.setBanker(false);\n\n        }\n\n        self.setGameState(self.state);\n    },\n\n\n    /**\n     * 抢庄\n     * @param {*} event \n     * @param {*} multiple \n     */\n    onClickForBanker(event, multiple) {\n        var data = {\n            roomNo: self.roomCode,\n            seatId: self.mySeatId,\n            betPointQuantity: Number(multiple)\n        }\n        requestHandler.sendRequest(events.game.C2S_ROB_BANKER, data);\n    },\n\n    /**\n     * 抢庄回调\n     * @param {*} data \n     */\n    onReceive_robBanker(data) {\n        console.log(\"抢庄回调：\", data);\n        self.bankerNode.active = false;\n    },\n\n\n\n    /**\n     * 下注\n     * @param {*} event \n     * @param {*} multiple \n     */\n    onClickForBet(event, multiple) {\n        var data = {\n            roomNo: self.roomCode,\n            seatId: self.mySeatId,\n            betPointQuantity: Number(multiple)\n        }\n        requestHandler.sendRequest(events.game.C2S_BET, data);\n    },\n\n    /**\n     * 下注回调\n     * @param {*} data \n     */\n    onReceive_bet(data) {\n        console.log(\"下注回调：\", data);\n        self.betNode.active = false;\n    },\n\n    /**\n     * 抢庄结果回调\n     * @param {*} data \n     */\n    onReceive_roomBanker(data) {\n        console.log(\"庄家ID 回调：\", data)\n        self.bankerIndex = data.seatId;\n        if (data.seatId == self.mySeatId) {\n            self.myPlayerObj.setBanker(true)\n        } else {\n            self.players[data.seatId].setBanker(true)\n        }\n    },\n\n    /**\n    * 接受最后一张牌\n    * @param {*} data \n    */\n    onReceive_lastCard(data) {\n        console.log(\"庄家ID 回调：\", data)\n        self.myLastCardData = data\n\n\n    },\n\n    /**\n     * 按钮开牌\n     */\n    onClickForOpenCard() {\n        if (self.myLastCardData) {\n\n            var data = {\n                roomNo: self.roomCode,\n                seatId: self.mySeatId\n            }\n            requestHandler.sendRequest(events.game.C2S_OPEN_CARD, data);\n\n            this.myPlayerObj.openLastCard(self.myLastCardData.playerCardsSort, self.myLastCardData.lastCard, self.seatInfo.playerCard.niuType);\n        }\n    },\n\n    /**\n    * \n    * @param {*} data \n    */\n    onReceive_openCard(data) {\n        console.log(\"庄家ID 回调：\", data)\n\n        self.players[data.seatId].openLastCard(data.playerCard.sortedCards, data.playerCard.cards[4], data.playerCard.niuType)\n    },\n\n    /**\n     * 设置状态\n     * @param {*} state \n     */\n    setGameState(state) {\n\n        self.clockNode.active = false;\n        //抢庄\n        if (state == 2) {\n            this.spStateLabel.spriteFrame = self.sf_tableAtlas._spriteFrames[\"AutoAtlas-1_10\"];\n            this.runClock(10);\n            //普通玩家下注\n        } else if (state == 3) {\n            this.spStateLabel.spriteFrame = self.sf_tableAtlas._spriteFrames[\"AutoAtlas-1_18\"];\n            this.runClock(10);\n            //玩家看牌\n        } else if (state == 4) {\n            this.spStateLabel.spriteFrame = self.sf_tableAtlas._spriteFrames[\"AutoAtlas-1_03\"];\n            this.runClock(10);\n            //所有人开牌\n        } else if (state == 5) {\n            this.spStateLabel.spriteFrame = self.sf_tableAtlas._spriteFrames[\"AutoAtlas-1_03\"];\n            //自动准备\n        } else if (state == 6) {\n            this.spStateLabel.spriteFrame = self.sf_tableAtlas._spriteFrames[\"AutoAtlas-1_06\"];\n            this.runClock(10);\n        }\n    },\n\n    /**\n     * 开启闹钟\n     * @param {*} nTotalSecond \n     */\n    runClock(nTotalSecond) {\n        self.clockNode.stopAllActions();\n        self.clockNode.active = true;\n        this.clockLabel.string = nTotalSecond;\n        var cf_func = cc.callFunc(function () {\n            nTotalSecond = nTotalSecond - 1;\n            self.clockLabel.string = nTotalSecond;\n            if (nTotalSecond < 0) {\n                self.clockNode.active = false;\n            }\n        });\n        var delay = cc.delayTime(1);\n        var seq = cc.sequence(delay, cf_func);\n        var rep = cc.repeat(seq, nTotalSecond + 1);\n        self.clockNode.runAction(rep);\n    },\n\n    /**\n     * 测试按钮 \n     */\n    onClickButtonTest() {\n        var data = {\n            roomNo: self.roomCode,\n            seatId: self.mySeatId\n        }\n        requestHandler.sendRequest(events.game.C2S_RESET_GAMESTATE, data);\n    }\n\n});\n"]}