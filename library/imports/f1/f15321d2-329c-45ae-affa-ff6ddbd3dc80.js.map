{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\..\\assets\\resources\\Script\\view\\games\\Lock/assets\\resources\\Script\\view\\games\\Lock\\Lock.js"],"names":["RUNNING_SPEED","SPEED_INC","MAX_SPEED","HIT_RANGE","HIT_OPEN","PERFECT_RANGE","PERFECT_OPEN","NEXT_LOCK_MIN","NEXT_LOCK_MAX","PENALTY_TIME","LOCK_COUNT_MIN","LOCK_COUNT_MAX","WIN_DELAY","SIM_OP_LOCK_R","LEVEL_STATUS_NOT_RUNNING","LEVEL_STATUS_RUNNING","LEVEL_STATUS_RESOLVE","LEVEL_STATUS_PENALTY","RESULT_DRAW","RESULT_WIN","RESULT_FAIL","HIT_TYPE_NORMAL","HIT_TYPE_PERFECT","onfire","require","requestHandler","config","tools","events","prefabHelper","globalData","myUserInfo","otherUserInfo","HallData","consts","scenes","cc","Class","extends","Component","properties","canvas","Node","ndReady","ndReadyAni","ndButtonBack","ndButtonHelp","ndHelp","sprPKPortraitLeft","Sprite","sprPKPortraitRight","ndPKGenderLeftMale","ndPKGenderLeftFemale","ndPKGenderRightMale","ndPKGenderRightFemale","lblPKNameLeft","Label","lblPKNameRight","ndLock","ndLockTextOpen","ndLockTextLocked","ndLockDot","ndLockPointer","lblLockRemaining","lblLockOpRemaining","ndPerfect","ndExit","ndExitOK","ndExitCancel","sndHit","AudioSource","sndMiss","sndCountdown","randomSeed","currentSpeed","levelStatus","totalLock","remainLock","oRemainLock","onLoad","console","log","isNetwork","resetSinglePlay","initGame","serverListeners","game","GAME_DATA","onReceive_GameLogin","lock","S2C_START","onReceive_GameStart","S2C_PROGRESS","onReceive_UpdateProgress","S2C_GAMEOVER","onReceive_Resolve","forEach","on","element","node","EventType","TOUCH_START","canvas_onTouchStart","exitConfirm","TOUCH_END","exitGame","active","TOUCH_CANCEL","start","getComponent","Animation","update","dt","rotation","simOpponent","random","string","resolve","data","appId","getCurGameInfo","token","sendRequest","C2S_EXIT_GAME","director","loadScene","hall","HALL","fire","HALL_DATA","rawData","parseInt","Math","loadRemoteImage","event","customEventData","judgeHit","nextDotAngle","play","scheduleOnce","ANI_RESET","first","result","isHit","range","abs","openLock","ani","sendHit","schedule","penaltyOver","num","resultData","topPortrait","leftPortrait","rightPortrait","leftName","rightName","leftGender","rightGender","icon","name","sex","createResultScreen","printUserInfo","userInfo","uid","money","printLoginInfo","loginInfo","success","printProgressInfo","s_kaiSuoDaRen_progress","zhongZi","printStartInfo","startInfo","printResolveInfo","resolveInfo","youWin","progressInfo","maxLock","otherProgress","myProgress","data1","data2","gender","FEMALE","MALE","type","S2C_HIT","onDestroy","un","off"],"mappings":"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","file":"Lock.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\..\\assets\\resources\\Script\\view\\games\\Lock","sourcesContent":["const RUNNING_SPEED = 1.5; // 运行速度\r\nconst SPEED_INC = 0.05; // 速度递增\r\nconst MAX_SPEED = 3.0; // 最大速度\r\nconst HIT_RANGE = 10; // 判定角度范围\r\nconst HIT_OPEN = 1; // 命中开锁数\r\nconst PERFECT_RANGE = 4; // 完美命中判定范围\r\nconst PERFECT_OPEN = 2; // 完美命中开锁数\r\nconst NEXT_LOCK_MIN = 45; // 下一锁位最小角度\r\nconst NEXT_LOCK_MAX = 120; // 下一锁位最大角度\r\nconst PENALTY_TIME = 0.5; // 惩罚时间（秒）\r\nconst LOCK_COUNT_MIN = 45; // 最小锁数\r\nconst LOCK_COUNT_MAX = 60; // 最大锁数\r\nconst WIN_DELAY = 1.0; // 胜利延时\r\nconst SIM_OP_LOCK_R = 0.02; // 模拟单机时对手每帧开锁概率\r\nconst LEVEL_STATUS_NOT_RUNNING = 0;\r\nconst LEVEL_STATUS_RUNNING = 1;\r\nconst LEVEL_STATUS_RESOLVE = 2;\r\nconst LEVEL_STATUS_PENALTY = 3;\r\nconst RESULT_DRAW = 0;\r\nconst RESULT_WIN = 1;\r\nconst RESULT_FAIL = -1;\r\nconst HIT_TYPE_NORMAL = 1;\r\nconst HIT_TYPE_PERFECT = 2;\r\n\r\nvar onfire = require(\"onfire\"); //处理事件的类库\r\nvar requestHandler = require(\"RequestHandler\");\r\nvar config = require(\"config\");\r\nvar tools = require(\"Tools\");\r\nvar events = require(\"CustomEvents\");\r\nvar prefabHelper = require(\"PrefabHelper\");\r\nvar globalData = require(\"Global\");\r\nvar myUserInfo = null;\r\nvar otherUserInfo = null;\r\nvar HallData = require(\"HallData\");\r\nvar consts = require(\"Constants\");\r\nvar scenes = require(\"SceneList\");\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 画面\r\n        canvas: cc.Node,\r\n\r\n        // 准备画面\r\n        ndReady: cc.Node,\r\n        ndReadyAni: cc.Node,\r\n\r\n        // 菜单\r\n        ndButtonBack: cc.Node,\r\n        ndButtonHelp: cc.Node,\r\n\r\n        // 帮助\r\n        ndHelp: cc.Node,\r\n\r\n        // PK条\r\n        sprPKPortraitLeft: cc.Sprite,\r\n        sprPKPortraitRight: cc.Sprite,\r\n        ndPKGenderLeftMale: cc.Node,\r\n        ndPKGenderLeftFemale: cc.Node,\r\n        ndPKGenderRightMale: cc.Node,\r\n        ndPKGenderRightFemale: cc.Node,\r\n        lblPKNameLeft: cc.Label,\r\n        lblPKNameRight: cc.Label,\r\n\r\n        // 锁\r\n        ndLock: cc.Node,\r\n        ndLockTextOpen: cc.Node,\r\n        ndLockTextLocked: cc.Node,\r\n        ndLockDot: cc.Node,\r\n        ndLockPointer: cc.Node,\r\n        lblLockRemaining: cc.Label,\r\n        lblLockOpRemaining: cc.Label,\r\n\r\n        // 完美动画\r\n        ndPerfect: cc.Node,\r\n\r\n        // 退出\r\n        ndExit: cc.Node,\r\n        ndExitOK: cc.Node,\r\n        ndExitCancel: cc.Node,\r\n\r\n        // 音效\r\n        sndHit: cc.AudioSource,\r\n        sndMiss: cc.AudioSource,\r\n        sndCountdown: cc.AudioSource,\r\n\r\n        // 随机种子\r\n        randomSeed: 0,\r\n\r\n        // 当前速度\r\n        currentSpeed: 0,\r\n\r\n        // 关卡状态: 0-未运行, 1-运行中, 2-结算, 3-惩罚中\r\n        levelStatus: 0,\r\n\r\n        // 总锁数\r\n        totalLock: 0,\r\n\r\n        // 剩余锁数\r\n        remainLock: 0,\r\n\r\n        // 对手剩余锁数\r\n        oRemainLock: 0,\r\n    },\r\n\r\n    onLoad() {\r\n        console.log(\"============= onLoad started\")\r\n        // 单机模拟数据\r\n        if (!config.isNetwork) {\r\n            this.resetSinglePlay();\r\n            this.initGame();\r\n        } else {\r\n            // 服务器事件监听\r\n            var serverListeners = [\r\n                [events.game.GAME_DATA, this.onReceive_GameLogin, this],\r\n                [events.game.lock.S2C_START, this.onReceive_GameStart, this],\r\n                [events.game.lock.S2C_PROGRESS, this.onReceive_UpdateProgress, this],\r\n                [events.game.lock.S2C_GAMEOVER, this.onReceive_Resolve, this]\r\n            ];\r\n            serverListeners.forEach(element => {\r\n                onfire.on(element[0], element[1], element[2]);\r\n            });\r\n        }\r\n\r\n        // 事件挂载\r\n        this.node.on(cc.Node.EventType.TOUCH_START, this.canvas_onTouchStart, this);\r\n        this.ndButtonBack.on(cc.Node.EventType.TOUCH_START, this.exitConfirm, this);\r\n        this.ndExitOK.on(cc.Node.EventType.TOUCH_END, this.exitGame, this);\r\n        this.ndExitCancel.on(cc.Node.EventType.TOUCH_END, function() {\r\n            this.ndExit.active = false;\r\n        }, this);\r\n        this.ndButtonHelp.on(cc.Node.EventType.TOUCH_START, function() {\r\n            this.ndHelp.active = true;\r\n        }, this);\r\n        this.ndButtonHelp.on(cc.Node.EventType.TOUCH_END, function() {\r\n            this.ndHelp.active = false;\r\n        }, this);\r\n        this.ndButtonHelp.on(cc.Node.EventType.TOUCH_CANCEL, function() {\r\n            this.ndHelp.active = false;\r\n        }, this);\r\n\r\n        console.log(\"============= onLoad ended\")\r\n    },\r\n\r\n    start() {\r\n        console.log(\"============= start started\")\r\n        this.ndReadyAni.getComponent(cc.Animation).on(\"finished\", function() {\r\n            this.ndReady.active = false;\r\n            this.levelStatus = LEVEL_STATUS_RUNNING;\r\n        }, this);\r\n        console.log(\"============= start ended\")\r\n    },\r\n\r\n    update(dt) {\r\n        switch (this.levelStatus) {\r\n            case LEVEL_STATUS_RUNNING:\r\n                this.ndLockPointer.rotation += this.currentSpeed;\r\n                if (this.ndLockPointer.rotation > 360) this.ndLockPointer.rotation -= 360;\r\n                if (this.ndLockPointer.rotation < 0) this.ndLockPointer.rotation += 360;\r\n                // 模拟对手操作\r\n                this.simOpponent();\r\n                break;\r\n\r\n            case LEVEL_STATUS_PENALTY:\r\n                this.simOpponent();\r\n                break;\r\n        }\r\n    },\r\n\r\n    // 模拟对手操作\r\n    simOpponent: function() {\r\n        if (!config.isNetwork && tools.random() <= SIM_OP_LOCK_R) {\r\n            this.oRemainLock--;\r\n            this.lblLockOpRemaining.string = this.oRemainLock;\r\n            if (this.oRemainLock == 0) {\r\n                this.resolve(RESULT_FAIL);\r\n            }\r\n        }\r\n    },\r\n\r\n    // 退出确认\r\n    exitConfirm: function() {\r\n        this.ndExit.active = true;\r\n    },\r\n\r\n    // 退出游戏\r\n    exitGame: function() {\r\n        var data = {\r\n            appId: HallData.getCurGameInfo().appId,\r\n            token: globalData.myUserInfo.token,\r\n        };\r\n        requestHandler.sendRequest(events.game.C2S_EXIT_GAME, data);\r\n        cc.director.loadScene(scenes.hall.HALL, function() {\r\n            onfire.fire(events.hall.HALL_DATA, HallData.rawData);\r\n        });\r\n    },\r\n\r\n    // 模拟单机数据\r\n    resetSinglePlay: function() {\r\n        this.totalLock = this.remainLock = parseInt(Math.random() * (LOCK_COUNT_MAX - LOCK_COUNT_MIN + 1) + LOCK_COUNT_MIN);\r\n        this.oRemainLock = this.remainLock;\r\n        this.randomSeed = Math.random() * 0x7fffffff;\r\n        tools.loadRemoteImage(\"http://zyhdheads.oss-cn-beijing.aliyuncs.com/default1.png\", this.sprPKPortraitLeft);\r\n        tools.loadRemoteImage(\"http://zyhdheads.oss-cn-beijing.aliyuncs.com/default1.png\", this.sprPKPortraitRight);\r\n    },\r\n\r\n    // 触碰\r\n    canvas_onTouchStart: function(event, customEventData) {\r\n        if (this.ndExit.active || this.ndHelp.active) return;\r\n\r\n        switch (this.levelStatus) {\r\n            case LEVEL_STATUS_RUNNING:\r\n                this.judgeHit();\r\n                break;\r\n        }\r\n    },\r\n\r\n    // 初始化游戏\r\n    initGame: function() {\r\n        console.log(\"============ initGame started\");\r\n        this.lblLockRemaining.string = this.remainLock;\r\n        this.lblLockOpRemaining.string = this.oRemainLock;\r\n        this.currentSpeed = RUNNING_SPEED + SPEED_INC * (this.totalLock - this.remainLock);\r\n        this.ndLockDot.rotation = this.nextDotAngle(true);\r\n        this.ndReady.active = true;\r\n        this.ndReadyAni.active = true;\r\n        this.ndReadyAni.getComponent(cc.Animation).play();\r\n        this.scheduleOnce(function() {\r\n            this.sndCountdown.play();\r\n        }, 1);\r\n        this.ndLock.getComponent(cc.Animation).play(consts.game.lock.ANI_RESET);\r\n        this.ndLockPointer.rotation = 0;\r\n        console.log(\"============ initGame ended\");\r\n    },\r\n\r\n    // 获取下一角度\r\n    nextDotAngle: function(first = false) {\r\n        var result = 0;\r\n        if (first) {\r\n            result = tools.random() * (NEXT_LOCK_MAX - NEXT_LOCK_MIN + 1) + NEXT_LOCK_MIN;\r\n            // 左\r\n            if (tools.random() > 0.5) {\r\n                result = 360 - result;\r\n                this.currentSpeed = -RUNNING_SPEED;\r\n            }\r\n        } else {\r\n            result = this.ndLockPointer.rotation + (this.currentSpeed > 0 ? 1 : -1) * (tools.random() * (NEXT_LOCK_MAX - NEXT_LOCK_MIN + 1) + NEXT_LOCK_MIN);\r\n        }\r\n        if (result > 360) result -= 360;\r\n        else if (result < 0) result += 360;\r\n        return result;\r\n    },\r\n\r\n    // 是否命中\r\n    isHit: function(range) {\r\n        return (Math.abs(this.ndLockDot.rotation - this.ndLockPointer.rotation) <= range ||\r\n            Math.abs(this.ndLockDot.rotation - 360 - this.ndLockPointer.rotation) <= range ||\r\n            Math.abs(this.ndLockDot.rotation - this.ndLockPointer.rotation + 360) <= range);\r\n    },\r\n\r\n    // 判断命中\r\n    judgeHit: function() {\r\n        if (this.isHit(PERFECT_RANGE)) {\r\n            // 完美命中\r\n            this.openLock(PERFECT_OPEN);\r\n            this.currentSpeed = -((this.currentSpeed > 0 ? SPEED_INC : -SPEED_INC) + this.currentSpeed);\r\n            this.ndLockDot.rotation = this.nextDotAngle();\r\n            this.ndPerfect.active = true;\r\n            var ani = this.ndPerfect.getComponent(cc.Animation);\r\n            ani.play();\r\n            ani.on(\"finished\", function() {\r\n                this.ndPerfect.active = false;\r\n            }, this);\r\n            this.sndHit.play();\r\n            this.sendHit(HIT_TYPE_PERFECT);\r\n        } else if (this.isHit(HIT_RANGE)) {\r\n            // 命中\r\n            this.openLock(HIT_OPEN);\r\n            this.currentSpeed = -((this.currentSpeed > 0 ? SPEED_INC : -SPEED_INC) + this.currentSpeed);\r\n            this.ndLockDot.rotation = this.nextDotAngle();\r\n            this.sndHit.play();\r\n            this.sendHit(HIT_TYPE_NORMAL);\r\n        } else {\r\n            // 未命中\r\n            this.levelStatus = LEVEL_STATUS_PENALTY;\r\n            this.schedule(this.penaltyOver, PENALTY_TIME, 0);\r\n            this.ndLock.getComponent(cc.Animation).play(\"shake\");\r\n            this.sndMiss.play();\r\n        }\r\n    },\r\n\r\n    // 惩罚结束\r\n    penaltyOver: function() {\r\n        this.currentSpeed = -this.currentSpeed;\r\n        this.ndLockDot.rotation = this.nextDotAngle();\r\n        this.levelStatus = LEVEL_STATUS_RUNNING;\r\n    },\r\n\r\n    // 开锁\r\n    openLock: function(num) {\r\n        this.remainLock -= num;\r\n        if (this.remainLock < 0) this.remainLock = 0;\r\n        this.lblLockRemaining.string = this.remainLock;\r\n        if (this.remainLock == 0) {\r\n            this.ndLock.getComponent(cc.Animation).play(\"open\");\r\n            this.sndMiss.play();\r\n            this.levelStatus = LEVEL_STATUS_RESOLVE;\r\n            if (!config.isNetwork) {\r\n                this.scheduleOnce(function() {\r\n                    this.resolve(RESULT_WIN);\r\n                }, WIN_DELAY);\r\n            }\r\n        }\r\n    },\r\n\r\n    // 结算\r\n    resolve: function(result) {\r\n        console.log(\"resolve, result: \" + result);\r\n        this.levelStatus = LEVEL_STATUS_RESOLVE;\r\n        this.ndExit.active = false;\r\n        this.ndHelp.active = false;\r\n        var resultData = {};\r\n        if (!config.isNetwork) {\r\n            resultData.topPortrait = \"http://zyhdheads.oss-cn-beijing.aliyuncs.com/default1.png\";\r\n            resultData.leftPortrait = \"http://zyhdheads.oss-cn-beijing.aliyuncs.com/default1.png\";\r\n            resultData.rightPortrait = \"http://zyhdheads.oss-cn-beijing.aliyuncs.com/default1.png\";\r\n            resultData.leftName = \"左边的玩家\";\r\n            resultData.rightName = \"右边的玩家\";\r\n            resultData.leftGender = 1; // 左边性别 0:男 1:女\r\n            resultData.rightGender = 0; // 右边性别 0:男 1:女\r\n            resultData.result = 1; // 结果 1:胜利 0:平局 -1:失败\r\n            resultData.appId = 2; // 游戏id\r\n        } else {\r\n            resultData.topPortrait = myUserInfo.icon;\r\n            resultData.leftPortrait = myUserInfo.icon;\r\n            resultData.rightPortrait = otherUserInfo.icon;\r\n            resultData.leftName = myUserInfo.name;\r\n            resultData.rightName = otherUserInfo.name;\r\n            resultData.leftGender = myUserInfo.sex;\r\n            resultData.rightGender = otherUserInfo.sex;\r\n            resultData.result = result;\r\n            resultData.appId = HallData.getCurGameInfo().appId;\r\n        }\r\n        prefabHelper.createResultScreen(this.canvas, resultData);\r\n    },\r\n\r\n    // 输出用户信息\r\n    printUserInfo: function(userInfo) {\r\n        console.log(\"uid: \" + userInfo.uid + \"\\nname: \" + userInfo.name + \"\\nsex: \" + userInfo.sex +\r\n            \"\\nicon: \" + userInfo.icon + \"\\nmoney: \" + userInfo.money);\r\n    },\r\n\r\n    // 输出登录信息\r\n    printLoginInfo: function(loginInfo) {\r\n        console.log(\"success: \" + loginInfo.success + \"\\nmyUserInfo: \");\r\n        this.printUserInfo(loginInfo.myUserInfo);\r\n        console.log(\"otherUserInfo: \");\r\n        this.printUserInfo(loginInfo.otherUserInfo);\r\n        console.log(\"s_kaiSuoDaRen_progress: \");\r\n        this.printProgressInfo(loginInfo.s_kaiSuoDaRen_progress);\r\n        console.log(\"zhongZi: \" + loginInfo.zhongZi);\r\n    },\r\n\r\n    // 输出开始信息\r\n    printStartInfo: function(startInfo) {\r\n        console.log(\"success: \" + startInfo.success);\r\n    },\r\n\r\n    // 输出结算信息\r\n    printResolveInfo: function(resolveInfo) {\r\n        console.log(\"youWin: \" + resolveInfo.youWin);\r\n    },\r\n\r\n    // 输出进度信息\r\n    printProgressInfo: function(progressInfo) {\r\n        console.log(\"maxLock: \" + progressInfo.maxLock + \"\\notherProgress: \" + progressInfo.otherProgress + \"\\nmyProgress: \" + progressInfo.myProgress);\r\n    },\r\n\r\n    // 以下为Server回调\r\n    // 登录\r\n    onReceive_GameLogin: function(data1, data2) {\r\n        console.log(\"=============\", events.game.GAME_DATA, \"=== started\");\r\n        this.printLoginInfo(data1);\r\n        if (data1.success != 0) {\r\n            console.log(\"Server login failed: \" + data1.success);\r\n            return;\r\n        }\r\n        myUserInfo = data1.myUserInfo;\r\n        otherUserInfo = data1.otherUserInfo;\r\n        tools.randomSeed = parseInt(data1.zhongZi * 0x7fffffff);\r\n        this.totalLock = data1.s_kaiSuoDaRen_progress.maxLock;\r\n        this.remainLock = this.oRemainLock = this.totalLock;\r\n\r\n        // 头像\r\n        tools.loadRemoteImage(data1.myUserInfo.icon, this.sprPKPortraitLeft);\r\n        tools.loadRemoteImage(data1.otherUserInfo.icon, this.sprPKPortraitRight);\r\n\r\n        // 名称\r\n        this.lblPKNameLeft.string = data1.myUserInfo.name;\r\n        this.lblPKNameRight.string = data1.otherUserInfo.name;\r\n\r\n        // 性别\r\n        this.ndPKGenderLeftFemale.active = (data1.myUserInfo.sex == consts.gender.FEMALE);\r\n        this.ndPKGenderLeftMale.active = (data1.myUserInfo.sex == consts.gender.MALE);\r\n        this.ndPKGenderRightFemale.active = (data1.otherUserInfo.sex == consts.gender.FEMALE);\r\n        this.ndPKGenderRightMale.active = (data1.otherUserInfo.sex == consts.gender.MALE);\r\n\r\n        console.log(\"=============\", events.game.GAME_DATA, \"=== ended\");\r\n    },\r\n\r\n    // 游戏开始\r\n    onReceive_GameStart: function(data1, data2) {\r\n        console.log(\"=============\", events.game.lock.S2C_START, \"=== started\");\r\n        this.printStartInfo(data1);\r\n        if (data1.success != 0) {\r\n            console.log(\"Game start failed: \" + data1.success);\r\n        }\r\n        this.initGame();\r\n        console.log(\"=============\", events.game.lock.S2C_START, \"=== ended\");\r\n    },\r\n\r\n    // 更新游戏进度\r\n    onReceive_UpdateProgress: function(data1, data2) {\r\n        this.printProgressInfo(data1);\r\n        this.oRemainLock = data1.otherProgress;\r\n        this.lblLockOpRemaining.string = this.oRemainLock;\r\n    },\r\n\r\n    // 结算\r\n    onReceive_Resolve: function(data1, data2) {\r\n        this.printResolveInfo(data1);\r\n        this.resolve(data1.youWin);\r\n    },\r\n\r\n    // 发送命中消息给服务器\r\n    sendHit: function(type) {\r\n        if (!config.isNetwork) return;\r\n        var data = {\r\n            type: type\r\n        };\r\n        requestHandler.sendRequest(events.game.lock.S2C_HIT, data);\r\n    },\r\n\r\n    onDestroy: function() {\r\n        var serverListeners = [\r\n            [events.game.GAME_DATA, this.onReceive_GameLogin, this],\r\n            [events.game.lock.S2C_START, this.onReceive_GameStart, this],\r\n            [events.game.lock.S2C_PROGRESS, this.onReceive_UpdateProgress, this],\r\n            [events.game.lock.S2C_GAMEOVER, this.onReceive_Resolve, this]\r\n        ];\r\n        serverListeners.forEach(element => {\r\n            onfire.un(element[0]);\r\n        });\r\n        this.node.off(cc.Node.EventType.TOUCH_START);\r\n        this.ndButtonBack.off(cc.Node.EventType.TOUCH_START);\r\n        this.ndExitOK.off(cc.Node.EventType.TOUCH_END);\r\n        this.ndExitCancel.off(cc.Node.EventType.TOUCH_END);\r\n        this.ndButtonHelp.off(cc.Node.EventType.TOUCH_START);\r\n        this.ndButtonHelp.off(cc.Node.EventType.TOUCH_END);\r\n        this.ndButtonHelp.off(cc.Node.EventType.TOUCH_CANCEL);\r\n    },\r\n});"]}