{"version":3,"sources":["../../../../../../../assets/resources/Script/view/hall/assets/resources/Script/view/hall/LoginWeb.js"],"names":["onfire","require","events","tools","texts","requestHandler","serverConnect","scenes","that","cc","Class","extends","Component","properties","lblText","Label","onServerConnectError","obj","console","log","JSON","stringify","string","hall","LOGIN_FAILED","onServerConnectOpen","un","OPEN","data","phone","phoneCode","wechatCode","token","window","location","search","substring","sendRequest","C2S_LOGIN","on","S2C_LOGIN","data1","data2","success","director","loadScene","HALL","fire","HALL_DATA","onLoad","isBrowser","connect","ERROR","onDestroy"],"mappings":";;;;;;AAAA,IAAIA,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,SAASD,QAAQ,cAAR,CAAb;AACA,IAAIE,QAAQF,QAAQ,OAAR,CAAZ;AACA,IAAIG,QAAQH,QAAQ,MAAR,CAAZ;AACA,IAAII,iBAAiBJ,QAAQ,gBAAR,CAArB;AACA,IAAIK,gBAAgBL,QAAQ,eAAR,CAApB;AACA,IAAIM,SAASN,QAAQ,WAAR,CAAb;AACA,IAAIO,IAAJ;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAASL,GAAGM;AADJ,KAHP;;AAOLC,0BAAsB,8BAASC,GAAT,EAAc;AAChCC,gBAAQC,GAAR,CAAYC,KAAKC,SAAL,CAAeJ,GAAf,CAAZ;AACAT,aAAKM,OAAL,CAAaQ,MAAb,GAAsBlB,MAAMmB,IAAN,CAAWC,YAAjC;AACH,KAVI;;AAYLC,yBAAqB,+BAAW;AAC5BP,gBAAQC,GAAR,CAAY,kBAAZ;AACAnB,eAAO0B,EAAP,CAAUxB,OAAOF,MAAP,CAAc2B,IAAxB;;AAEA;AACA,YAAIC,OAAO;AACPC,mBAAO,EADA;AAEPC,uBAAW,EAFJ;AAGPC,wBAAY,EAHL;AAIPC,mBAAOC,OAAOC,QAAP,CAAgBC,MAAhB,CAAuBC,SAAvB,CAAiC,CAAjC;AAJA,SAAX;AAMA/B,uBAAegC,WAAf,CAA2BnC,OAAOqB,IAAP,CAAYe,SAAvC,EAAkDV,IAAlD;;AAEA;AACA5B,eAAOuC,EAAP,CAAUrC,OAAOqB,IAAP,CAAYiB,SAAtB,EAAiC,UAASC,KAAT,EAAgBC,KAAhB,EAAuB;AACpD,gBAAID,MAAME,OAAN,IAAiB,CAArB,EAAwB;AACpBzB,wBAAQC,GAAR,CAAYC,KAAKC,SAAL,CAAeoB,KAAf,CAAZ;;AAEA;AACAhC,mBAAGmC,QAAH,CAAYC,SAAZ,CAAsBtC,OAAOgB,IAAP,CAAYuB,IAAlC,EAAwC,YAAW;AAC/C9C,2BAAO+C,IAAP,CAAY7C,OAAOqB,IAAP,CAAYyB,SAAxB,EAAmCP,KAAnC,EAA0CC,KAA1C;AACH,iBAFD;AAGH,aAPD,MAOO;AACHlC,qBAAKM,OAAL,CAAaQ,MAAb,GAAsBlB,MAAMmB,IAAN,CAAWC,YAAjC;AACH;;AAEDxB,mBAAO0B,EAAP,CAAUxB,OAAOqB,IAAP,CAAYiB,SAAtB;AACH,SAbD;AAcH,KAxCI;;AA0CLS,UA1CK,oBA0CI;AACLzC,eAAO,IAAP;AACA,YAAI,CAACL,MAAM+C,SAAN,EAAL,EAAwB;AACpB1C,iBAAKM,OAAL,CAAaQ,MAAb,GAAsBlB,MAAMmB,IAAN,CAAWC,YAAjC;AACA;AACH;;AAED,YAAIS,OAAOC,QAAP,CAAgBC,MAAhB,IAA0B,EAA9B,EAAkC;AAC9B3B,iBAAKM,OAAL,CAAaQ,MAAb,GAAsBlB,MAAMmB,IAAN,CAAWC,YAAjC;AACA;AACH;;AAEDlB,sBAAc6C,OAAd;AACAnD,eAAOuC,EAAP,CAAUrC,OAAOF,MAAP,CAAc2B,IAAxB,EAA8BnB,KAAKiB,mBAAnC,EAAwDjB,IAAxD;AACAR,eAAOuC,EAAP,CAAUrC,OAAOF,MAAP,CAAcoD,KAAxB,EAA+B5C,KAAKQ,oBAApC,EAA0DR,IAA1D;AACH,KAzDI;AA2DL6C,aA3DK,uBA2DO;AACRrD,eAAO0B,EAAP,CAAUxB,OAAOF,MAAP,CAAc2B,IAAxB;AACA3B,eAAO0B,EAAP,CAAUxB,OAAOF,MAAP,CAAcoD,KAAxB;AACApD,eAAO0B,EAAP,CAAUxB,OAAOqB,IAAP,CAAYiB,SAAtB;AACH;AA/DI,CAAT","file":"LoginWeb.js","sourceRoot":"../../../../../../../assets/resources/Script/view/hall","sourcesContent":["var onfire = require(\"onfire\");\r\nvar events = require(\"CustomEvents\");\r\nvar tools = require(\"Tools\");\r\nvar texts = require(\"Text\");\r\nvar requestHandler = require(\"RequestHandler\");\r\nvar serverConnect = require(\"ServerConnect\");\r\nvar scenes = require(\"SceneList\");\r\nvar that;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lblText: cc.Label,\r\n    },\r\n\r\n    onServerConnectError: function(obj) {\r\n        console.log(JSON.stringify(obj));\r\n        that.lblText.string = texts.hall.LOGIN_FAILED;\r\n    },\r\n\r\n    onServerConnectOpen: function() {\r\n        console.log(\"server connected\");\r\n        onfire.un(events.onfire.OPEN);\r\n\r\n        // 向服务端发送登录信息\r\n        var data = {\r\n            phone: \"\",\r\n            phoneCode: \"\",\r\n            wechatCode: \"\",\r\n            token: window.location.search.substring(1),\r\n        };\r\n        requestHandler.sendRequest(events.hall.C2S_LOGIN, data);\r\n\r\n        // 大厅登录信息\r\n        onfire.on(events.hall.S2C_LOGIN, function(data1, data2) {\r\n            if (data1.success == 0) {\r\n                console.log(JSON.stringify(data1));\r\n\r\n                // 切换场景\r\n                cc.director.loadScene(scenes.hall.HALL, function() {\r\n                    onfire.fire(events.hall.HALL_DATA, data1, data2);\r\n                });\r\n            } else {\r\n                that.lblText.string = texts.hall.LOGIN_FAILED;\r\n            }\r\n\r\n            onfire.un(events.hall.S2C_LOGIN);\r\n        });\r\n    },\r\n\r\n    onLoad() {\r\n        that = this;\r\n        if (!tools.isBrowser()) {\r\n            that.lblText.string = texts.hall.LOGIN_FAILED;\r\n            return;\r\n        }\r\n\r\n        if (window.location.search == \"\") {\r\n            that.lblText.string = texts.hall.LOGIN_FAILED;\r\n            return;\r\n        }\r\n\r\n        serverConnect.connect();\r\n        onfire.on(events.onfire.OPEN, that.onServerConnectOpen, that);\r\n        onfire.on(events.onfire.ERROR, that.onServerConnectError, that);\r\n    },\r\n\r\n    onDestroy() {\r\n        onfire.un(events.onfire.OPEN);\r\n        onfire.un(events.onfire.ERROR);\r\n        onfire.un(events.hall.S2C_LOGIN);\r\n    },\r\n});"]}